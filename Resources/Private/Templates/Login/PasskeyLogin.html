<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      data-namespace-typo3-fluid="true">

<div class="passkey-login" id="passkey-login-container"
     data-options-url="{loginOptionsUrl}"
     data-rp-id="{rpId}"
     data-origin="{origin}"
     data-discoverable="{f:if(condition: discoverableEnabled, then: '1', else: '0')}">

    <f:if condition="{passwordLoginDisabled}">
        <f:then>
            <div class="alert alert-info mb-3">
                <f:translate key="LLL:EXT:nr_passkeys_be/Resources/Private/Language/locallang.xlf:login.info.passkeyOnly">
                    Password login is disabled. Please use your passkey to sign in.
                </f:translate>
            </div>
        </f:then>
    </f:if>

    <div class="form-group mb-3" id="passkey-username-group">
        <label for="passkey-username" class="form-label">
            <f:translate key="LLL:EXT:core/Resources/Private/Language/locallang_core.xlf:labels.username">
                Username
            </f:translate>
        </label>
        <input type="text" id="passkey-username" name="username"
               class="form-control" autocomplete="username webauthn"
               placeholder="Username" required="required" />
    </div>

    <button type="button" id="passkey-login-btn" class="btn btn-primary btn-block w-100 mb-3">
        <span class="passkey-icon me-2">&#128274;</span>
        <span id="passkey-btn-text">
            <f:translate key="LLL:EXT:nr_passkeys_be/Resources/Private/Language/locallang.xlf:login.button.passkey">
                Continue with Passkey
            </f:translate>
        </span>
        <span id="passkey-btn-loading" class="d-none">
            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
            <f:translate key="LLL:EXT:nr_passkeys_be/Resources/Private/Language/locallang.xlf:login.button.passkey.loading">
                Authenticating...
            </f:translate>
        </span>
    </button>

    <div id="passkey-error" class="alert alert-danger d-none" role="alert"></div>

    <!-- Hidden fields for submitting passkey data to the TYPO3 login form -->
    <input type="hidden" name="passkey_assertion" id="passkey-assertion" value="" />
    <input type="hidden" name="passkey_challenge_token" id="passkey-challenge-token" value="" />

    <f:if condition="{!passwordLoginDisabled}">
        <div class="text-center mt-3">
            <a href="#" id="passkey-password-fallback" class="text-muted small">
                <f:translate key="LLL:EXT:nr_passkeys_be/Resources/Private/Language/locallang.xlf:login.link.usePassword"
                             default="Use password instead" />
            </a>
        </div>
    </f:if>

    <noscript>
        <div class="alert alert-warning">
            JavaScript is required for passkey authentication.
        </div>
    </noscript>
</div>

</html>
